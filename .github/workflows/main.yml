name: Instant README update

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  workflow_dispatch: 

jobs:
  CI:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup Dependency
        run: |
          cd $GITHUB_WORKSPACE
          git submodule update --init --recursive
          ls -ahl

      - name: Converting log format
        run: |
          python utils/ELOMMR.py logs/*.log
          mkdir Elo-MMR/cache
          mkdir Elo-MMR/cache/TFM
          mv logs/S*/* Elo-MMR/cache/TFM/

      - name: Run Elo-MMR calculator
        uses: actions-rs/cargo@v1
        with:
          command: run
          args: --manifest-path ./Elo-MMR/multi-skill/Cargo.toml --release --bin rate mmr TFM 
      
      - name: Checkout result
        run: |
          cd $GITHUB_WORKSPACE
          cat Elo-MMR/experiments/TFM/ratings_output.csv
